<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Verify UI Final Polish</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f0f2f5; padding: 20px; }

        /* CSS from index.php */
        .message-bubble {
            max-width: 75%;
            width: fit-content;
            min-width: 40px;
            white-space: pre-wrap;
            overflow-wrap: break-word;
            word-break: normal;
            border-radius: 18px;
            padding: 10px 14px;
            position: relative;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            font-size: 0.95rem;
            line-height: 1.45;
        }

        .message-contact {
            background-color: #ffffff;
            color: #1e293b;
            border-bottom-left-radius: 4px;
            margin-left: 0;
        }
        .message-contact::before {
            content: "";
            position: absolute;
            bottom: 0;
            left: -8px;
            width: 0;
            height: 0;
            border-right: 12px solid #ffffff;
            border-top: 12px solid transparent;
        }

        .message-agent {
            background-color: #7c3aed;
            color: white;
            border-bottom-right-radius: 4px;
            margin-right: 6px;
        }
        .message-agent::after {
            content: "";
            position: absolute;
            bottom: 0;
            right: -8px;
            width: 0;
            height: 0;
            border-left: 12px solid #7c3aed;
            border-top: 12px solid transparent;
        }

        .message-timestamp {
            float: right;
            font-size: 0.65rem;
            margin-left: 8px;
            margin-top: 10px; /* The change we are testing */
            vertical-align: bottom;
            line-height: 1;
            position: relative;
            top: 2px;
        }
        .message-contact .message-timestamp { color: #94a3b8; } /* slate-400 */
        .message-agent .message-timestamp { color: rgba(255, 255, 255, 0.7); }
    </style>
</head>
<body>

    <div id="mock-ui" class="max-w-md mx-auto bg-slate-50 h-[600px] border rounded-xl overflow-hidden flex flex-col">
        <div class="bg-white p-3 border-b shadow-sm z-10">
            <h3 id="chat-partner-name" class="font-bold">Ananias</h3>
        </div>

        <div id="message-container" class="flex-1 p-4 overflow-y-auto space-y-4">
            <!-- Messages will be injected here -->
        </div>
    </div>

    <script>
        // Mocks
        function safeDate(d) { return new Date(); }
        window.currentContactAvatar = null;

        // Copied Logic from index.php (latest version)
        function createMessageElement(msg) {
            const type = String(msg.sender_type || '').toLowerCase();
            const isAgent = (type === 'agent' || type === 'user');
            const bubbleWrapper = document.createElement('div');
            // Reduced gap-2 to gap-1 for closer connection
            bubbleWrapper.className = 'flex ' + (isAgent ? 'justify-end' : 'justify-start') + ' items-end gap-1 mb-2';
            bubbleWrapper.id = `msg-${msg.id}`;

            const timeString = "10:42 PM"; // Fixed time for consistent screenshot

            let statusIcon = '';
            if (isAgent) {
                let iconClass = 'text-gray-300';
                let iconType = 'fa-check';

                if (msg.status === 'read') {
                    iconType = 'fa-check-double';
                    iconClass = 'text-blue-300';
                } else if (msg.status === 'delivered') {
                    iconType = 'fa-check-double';
                    iconClass = 'text-gray-300';
                }

                statusIcon = `<i class="fas ${iconType} ${iconClass} text-[10px] ml-1"></i>`;
            }

            let avatarHtml = '';
            if (!isAgent) {
                const contactName = (document.getElementById('chat-partner-name').textContent || 'User').trim();
                const initial = (contactName.length > 0) ? contactName.charAt(0).toUpperCase() : '?';

                const profileImg = window.currentContactAvatar;

                if (profileImg) {
                    avatarHtml = `<img src="${profileImg}" class="flex-shrink-0 w-7 h-7 rounded-full object-cover border border-gray-200 shadow-sm" alt="${initial}">`;
                } else {
                    avatarHtml = `<div class="flex-shrink-0 w-7 h-7 rounded-full bg-gray-300 text-gray-600 flex items-center justify-center text-[10px] font-bold border border-gray-200 shadow-sm cursor-default" title="${contactName}">${initial}</div>`;
                }
            }

            const timestampHtml = `<span class="message-timestamp select-none">${timeString}${statusIcon}</span>`;

            if (isAgent) {
                bubbleWrapper.innerHTML = `<div class="message-bubble message-agent shadow-sm">${msg.content}${timestampHtml}</div>`;
            } else {
                bubbleWrapper.innerHTML = `${avatarHtml}<div class="message-bubble message-contact shadow-sm">${msg.content}${timestampHtml}</div>`;
            }
            return bubbleWrapper;
        }

        // Test Data
        const messages = [
            { id: 1, sender_type: 'agent', content: 'Hello Ananias, how can I help?', status: 'read' },
            { id: 2, sender_type: 'contact', content: 'I need to check my balance.', status: 'received' },
            { id: 3, sender_type: 'contact', content: 'Is it possible to do it online?', status: 'received' },
            { id: 4, sender_type: 'agent', content: 'Yes, absolutely. You can login to the portal.', status: 'delivered' },
            { id: 5, sender_type: 'contact', content: 'Short', status: 'received' }
        ];

        // Render
        const container = document.getElementById('message-container');
        messages.forEach(msg => {
            container.appendChild(createMessageElement(msg));
        });

    </script>
</body>
</html>
